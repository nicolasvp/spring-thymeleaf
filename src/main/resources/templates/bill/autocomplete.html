<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<script type="text/javascript" th:fragment="javascript">
	$(document).ready(function(){
		$("#buscar_producto").autocomplete({
			source: function(request, response){
				$.ajax({
					url: "/bill/get-products/" + request.term,
					dataType: "json",
					data: {
						term: request.term
					},
					success: function(data){
						response($.map(data,function(item){
							return {
								value: item.id,
								label: item.name,
								price: item.price
							}
						}));
					},
					
				});
			},
			select: function(event, ui){
				//$("#buscar_producto").val(ui.item.label);
				
				var line = $("#billItemsTemplate").html();
				
				line = line.replace(/{ID}/g, ui.item.value);
				line = line.replace(/{NAME}/g, ui.item.label);
				line = line.replace(/{PRICE}/g, ui.item.price);
				
				$("#loadItemProducts tbody").append(line);
				itemsHelper.calculateImport(ui.item.value, ui.item.price, 1);
				
				return false;
			}
		});
	});
	
	var itemsHelper = {
		calculateImport: function(id, price, quantity){
			$("#totalImport_" + id).html(parseInt(price) * parseInt(quantity));
		}
	};
</script>
</body>
</html>